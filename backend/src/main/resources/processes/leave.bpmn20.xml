<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
             xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC"
             xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI"
             xmlns:flowable="http://flowable.org/bpmn"
             targetNamespace="http://magic-crm/leave"
             exporter="Flowable Open Source Modeler"
             exporterVersion="6.7.2">

  <process id="leave_process" name="员工请假流程" isExecutable="true">
    
    <startEvent id="start" name="发起请假"/>
    
    <sequenceFlow id="flow_start_to_manager" sourceRef="start" targetRef="managerApprove"/>
    
    <userTask id="managerApprove" name="主管审批" flowable:assignee="${managerUserId}">
      <documentation>主管审批员工请假申请</documentation>
    </userTask>
    
    <sequenceFlow id="flow_manager_to_gateway" sourceRef="managerApprove" targetRef="gateway_after_manager"/>
    
    <exclusiveGateway id="gateway_after_manager" name="审批结果判断"/>
    
    <!-- 主管拒绝 -->
    <sequenceFlow id="flow_manager_reject" name="主管拒绝" sourceRef="gateway_after_manager" targetRef="end_reject">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${approvedByManager == false}]]></conditionExpression>
    </sequenceFlow>
    
    <!-- 主管同意且天数<=3：直接通过 -->
    <sequenceFlow id="flow_manager_approve_short" name="≤3天直接通过" sourceRef="gateway_after_manager" targetRef="end_approved">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${approvedByManager == true && days <= 3}]]></conditionExpression>
    </sequenceFlow>
    
    <!-- 主管同意且天数>3：需HR审批 -->
    <sequenceFlow id="flow_need_hr" name=">3天需HR审批" sourceRef="gateway_after_manager" targetRef="hrApprove">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${approvedByManager == true && days > 3}]]></conditionExpression>
    </sequenceFlow>
    
    <userTask id="hrApprove" name="HR审批" flowable:assignee="${hrUserId}">
      <documentation>HR审批超过3天的请假申请</documentation>
    </userTask>
    
    <sequenceFlow id="flow_hr_to_gateway" sourceRef="hrApprove" targetRef="gateway_after_hr"/>
    
    <exclusiveGateway id="gateway_after_hr" name="HR审批结果"/>
    
    <sequenceFlow id="flow_hr_reject" name="HR拒绝" sourceRef="gateway_after_hr" targetRef="end_reject">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${approvedByHR == false}]]></conditionExpression>
    </sequenceFlow>
    
    <sequenceFlow id="flow_hr_approve" name="HR通过" sourceRef="gateway_after_hr" targetRef="end_approved">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${approvedByHR == true}]]></conditionExpression>
    </sequenceFlow>
    
    <endEvent id="end_approved" name="审批通过"/>
    <endEvent id="end_reject" name="审批拒绝"/>
    
  </process>

  <!-- 图形信息 (Diagram Interchange) -->
  <bpmndi:BPMNDiagram id="BPMNDiagram_leave_process">
    <bpmndi:BPMNPlane bpmnElement="leave_process" id="BPMNPlane_leave_process">
      
      <!-- 开始事件 -->
      <bpmndi:BPMNShape bpmnElement="start" id="BPMNShape_start">
        <omgdc:Bounds height="35.0" width="35.0" x="100.0" y="200.0"/>
      </bpmndi:BPMNShape>
      
      <!-- 主管审批 -->
      <bpmndi:BPMNShape bpmnElement="managerApprove" id="BPMNShape_managerApprove">
        <omgdc:Bounds height="80.0" width="100.0" x="200.0" y="177.5"/>
      </bpmndi:BPMNShape>
      
      <!-- 第一个网关 -->
      <bpmndi:BPMNShape bpmnElement="gateway_after_manager" id="BPMNShape_gateway_after_manager">
        <omgdc:Bounds height="40.0" width="40.0" x="370.0" y="197.5"/>
      </bpmndi:BPMNShape>
      
      <!-- HR审批 -->
      <bpmndi:BPMNShape bpmnElement="hrApprove" id="BPMNShape_hrApprove">
        <omgdc:Bounds height="80.0" width="100.0" x="480.0" y="177.5"/>
      </bpmndi:BPMNShape>
      
      <!-- 第二个网关 -->
      <bpmndi:BPMNShape bpmnElement="gateway_after_hr" id="BPMNShape_gateway_after_hr">
        <omgdc:Bounds height="40.0" width="40.0" x="650.0" y="197.5"/>
      </bpmndi:BPMNShape>
      
      <!-- 通过结束事件 -->
      <bpmndi:BPMNShape bpmnElement="end_approved" id="BPMNShape_end_approved">
        <omgdc:Bounds height="35.0" width="35.0" x="750.0" y="200.0"/>
      </bpmndi:BPMNShape>
      
      <!-- 拒绝结束事件 -->
      <bpmndi:BPMNShape bpmnElement="end_reject" id="BPMNShape_end_reject">
        <omgdc:Bounds height="35.0" width="35.0" x="750.0" y="300.0"/>
      </bpmndi:BPMNShape>
      
      <!-- 连线 -->
      <bpmndi:BPMNEdge bpmnElement="flow_start_to_manager" id="BPMNEdge_flow_start_to_manager">
        <omgdi:waypoint x="135.0" y="217.5"/>
        <omgdi:waypoint x="200.0" y="217.5"/>
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge bpmnElement="flow_manager_to_gateway" id="BPMNEdge_flow_manager_to_gateway">
        <omgdi:waypoint x="300.0" y="217.5"/>
        <omgdi:waypoint x="370.0" y="217.5"/>
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge bpmnElement="flow_manager_reject" id="BPMNEdge_flow_manager_reject">
        <omgdi:waypoint x="390.0" y="237.5"/>
        <omgdi:waypoint x="390.0" y="317.5"/>
        <omgdi:waypoint x="750.0" y="317.5"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="48.0" x="366.0" y="280.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge bpmnElement="flow_manager_approve_short" id="BPMNEdge_flow_manager_approve_short">
        <omgdi:waypoint x="390.0" y="197.5"/>
        <omgdi:waypoint x="390.0" y="120.0"/>
        <omgdi:waypoint x="767.5" y="120.0"/>
        <omgdi:waypoint x="767.5" y="200.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="84.0" x="536.0" y="106.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge bpmnElement="flow_need_hr" id="BPMNEdge_flow_need_hr">
        <omgdi:waypoint x="410.0" y="217.5"/>
        <omgdi:waypoint x="480.0" y="217.5"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="84.0" x="403.0" y="203.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge bpmnElement="flow_hr_to_gateway" id="BPMNEdge_flow_hr_to_gateway">
        <omgdi:waypoint x="580.0" y="217.5"/>
        <omgdi:waypoint x="650.0" y="217.5"/>
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge bpmnElement="flow_hr_reject" id="BPMNEdge_flow_hr_reject">
        <omgdi:waypoint x="670.0" y="237.5"/>
        <omgdi:waypoint x="670.0" y="317.5"/>
        <omgdi:waypoint x="750.0" y="317.5"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="36.0" x="652.0" y="280.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge bpmnElement="flow_hr_approve" id="BPMNEdge_flow_hr_approve">
        <omgdi:waypoint x="690.0" y="217.5"/>
        <omgdi:waypoint x="750.0" y="217.5"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="36.0" x="702.0" y="203.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
  
</definitions>
