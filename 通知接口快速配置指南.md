# 通知接口快速配置指南

## 快速开始

### 1. 邮件通知配置（推荐优先配置）

1. **获取邮箱授权码**
   - QQ邮箱：设置 → 账户 → 开启SMTP服务 → 获取授权码
   - Gmail：设置 → 安全 → 两步验证 → 应用专用密码
   - 企业邮箱：联系管理员获取SMTP配置

2. **配置系统设置**
   ```
   进入：系统设置 → 邮件配置
   填写：
   - SMTP服务器地址：smtp.qq.com (QQ邮箱)
   - SMTP端口：587
   - SMTP用户名：your-email@qq.com
   - SMTP密码：授权码（不是登录密码）
   - 发件人邮箱：your-email@qq.com
   - 发件人名称：CRM系统
   ```

3. **测试配置**
   - 点击"测试"按钮
   - 输入测试邮箱和内容
   - 点击"发送测试"

### 2. 短信通知配置

1. **注册阿里云账号**
   - 访问：https://www.aliyun.com
   - 注册并实名认证

2. **开通短信服务**
   - 控制台 → 短信服务
   - 申请短信签名
   - 申请短信模板

3. **配置系统设置**
   ```
   进入：系统设置 → 短信配置
   填写：
   - 短信服务商：aliyun
   - AccessKeyId：从阿里云控制台获取
   - AccessKeySecret：从阿里云控制台获取
   - 短信签名：已审核通过的签名
   - 短信模板代码：已审核通过的模板代码
   ```

### 3. 微信通知配置

1. **注册企业微信**
   - 访问：https://work.weixin.qq.com
   - 注册企业微信账号

2. **创建应用**
   - 管理后台 → 应用管理 → 创建应用
   - 获取CorpID、Secret、AgentID

3. **配置系统设置**
   ```
   进入：系统设置 → 微信配置
   填写：
   - 企业微信CorpID：从企业微信管理后台获取
   - 企业微信Secret：应用Secret
   - 企业微信AgentID：应用AgentID
   ```

### 4. 钉钉通知配置

1. **创建钉钉群机器人**
   - 钉钉群 → 群设置 → 智能群助手 → 添加机器人
   - 选择"自定义"机器人
   - 获取Webhook地址

2. **配置系统设置**
   ```
   进入：系统设置 → 钉钉配置
   填写：
   - 钉钉Webhook地址：从机器人设置中获取
   ```

### 5. 推送通知配置

1. **注册极光推送**
   - 访问：https://www.jiguang.cn
   - 注册并创建应用

2. **配置系统设置**
   ```
   进入：系统设置 → 推送配置
   填写：
   - 推送服务商：jpush
   - 极光推送AppKey：从极光控制台获取
   - 极光推送MasterSecret：从极光控制台获取
   - 生产环境：false（测试环境）
   ```

## 用户通知设置

### 1. 配置个人通知偏好

1. **进入通知设置**
   - 左侧菜单 → 通知设置

2. **启用通知渠道**
   - 勾选需要接收的通知类型
   - 设置通知时间
   - 配置免打扰时间

### 2. 通知类型说明

- **站内信**：系统内消息，无需额外配置
- **邮件**：需要配置邮箱地址
- **短信**：需要配置手机号码
- **微信**：需要绑定企业微信账号
- **钉钉**：需要加入钉钉群
- **推送**：需要安装移动端应用

## 测试通知功能

### 1. 系统级测试

1. **邮件测试**
   ```bash
   curl -X POST http://localhost:8080/api/system-settings/test/email \
     -H "Content-Type: application/json" \
     -d '{"email": "test@example.com", "content": "测试邮件"}'
   ```

2. **短信测试**
   ```bash
   curl -X POST http://localhost:8080/api/system-settings/test/sms \
     -H "Content-Type: application/json" \
     -d '{"phone": "13800138000", "content": "测试短信"}'
   ```

### 2. 业务通知测试

1. **创建工作流任务**
   - 启动一个工作流流程
   - 系统会自动发送通知

2. **查看通知记录**
   - 进入通知管理页面
   - 查看通知发送状态

## 常见问题

### Q1: 邮件发送失败
**A**: 检查邮箱授权码是否正确，确认SMTP服务已开启

### Q2: 短信发送失败
**A**: 检查阿里云短信签名和模板是否审核通过

### Q3: 微信消息发送失败
**A**: 检查企业微信应用权限和用户是否在企业内

### Q4: 钉钉消息发送失败
**A**: 检查Webhook地址是否正确，机器人是否已启用

### Q5: 推送发送失败
**A**: 检查极光推送AppKey和MasterSecret是否正确

## 配置检查清单

- [ ] 邮件SMTP配置完成并测试通过
- [ ] 短信服务配置完成并测试通过
- [ ] 微信企业号配置完成并测试通过
- [ ] 钉钉机器人配置完成并测试通过
- [ ] 推送服务配置完成并测试通过
- [ ] 用户通知设置配置完成
- [ ] 通知模板创建完成
- [ ] 工作流通知测试通过

## 下一步

1. 配置完成后，建议先测试所有通知渠道
2. 创建通知模板，定制通知内容
3. 配置工作流，启用自动通知
4. 培训用户使用通知功能
5. 监控通知发送状态，及时处理问题

---

**注意**: 请确保所有第三方服务的账号都已实名认证，并遵守相关服务的使用条款。
